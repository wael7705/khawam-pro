# دليل الاختبارات

## الاختبارات المنجزة

### 1. تسجيل الدخول
- ✅ البحث برقم الهاتف
- ✅ البحث بالبريد الإلكتروني
- ✅ البحث بالاسم (name)
- ✅ دعم جميع أشكال أرقام الهاتف (0966320114, 963966320114, +963966320114, etc.)

### 2. فلترة الطلبات
- ✅ العملاء يرون فقط طلباتهم الخاصة (حسب رقم الهاتف)
- ✅ المديرون والموظفون يرون جميع الطلبات
- ✅ يتطلب تسجيل الدخول لعرض الطلبات

### 3. عرض الملفات والصور
- ✅ جميع أنواع الملفات والصور تظهر في تفاصيل الطلب
- ✅ الملفات المحفوظة على السيرفر متاحة عبر URLs ثابتة

## كيفية تشغيل الاختبارات

### 1. تشغيل السكربت المحلي

```bash
# تأكد من تشغيل السيرفر أولاً
cd backend
python test_auth_and_orders.py
```

### 2. تشغيل الاختبارات على الإنتاج

```bash
# حدد URL الإنتاج
export API_BASE_URL="https://khawam-pro-production.up.railway.app/api"
python test_auth_and_orders.py
```

### 3. اختبار يدوي

#### تسجيل الدخول:
```bash
curl -X POST "https://khawam-pro-production.up.railway.app/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "0966320114", "password": "admin123"}'
```

#### جلب الطلبات:
```bash
# استبدل TOKEN بالرمز الذي حصلت عليه من تسجيل الدخول
curl -X GET "https://khawam-pro-production.up.railway.app/api/orders/" \
  -H "Authorization: Bearer TOKEN"
```

## اختبارات محددة

### اختبار 1: تسجيل الدخول برقم الهاتف
```python
client = TestClient(BASE_URL)
client.login("0966320114", "admin123")
```

### اختبار 2: تسجيل الدخول بالاسم
```python
client = TestClient(BASE_URL)
client.login("اسم المستخدم", "admin123")
```

### اختبار 3: جلب طلبات العميل
```python
client = TestClient(BASE_URL)
if client.login("0966320114", "admin123"):
    orders = client.get_orders()
    # يجب أن ترى فقط طلبات هذا العميل
```

### اختبار 4: جلب طلبات المدير
```python
client = TestClient(BASE_URL)
if client.login("admin_username", "admin_password"):
    orders = client.get_orders()
    # يجب أن ترى جميع الطلبات
```

## المشاكل المحتملة والحلول

### المشكلة 1: "اسم المستخدم أو كلمة المرور غير صحيحة"
- **السبب**: قد يكون المستخدم غير موجود أو كلمة المرور خاطئة
- **الحل**: تأكد من أن المستخدم موجود في قاعدة البيانات وأن كلمة المرور صحيحة

### المشكلة 2: "يجب تسجيل الدخول لعرض طلباتك"
- **السبب**: لم يتم تسجيل الدخول أو token غير صحيح
- **الحل**: تأكد من تسجيل الدخول أولاً والحصول على token صحيح

### المشكلة 3: العملاء يرون جميع الطلبات
- **السبب**: قد يكون المستخدم لديه نوع "مدير" أو "موظف" بدلاً من "عميل"
- **الحل**: تأكد من أن نوع المستخدم في قاعدة البيانات هو "عميل"

## ملاحظات

1. تأكد من أن قاعدة البيانات تحتوي على بيانات صحيحة
2. تأكد من أن المستخدم لديه رقم هاتف صحيح
3. تأكد من أن الطلبات مرتبطة برقم هاتف المستخدم
4. تأكد من أن نوع المستخدم صحيح في قاعدة البيانات

