# ุฅุตูุงุญ ุฎุทุฃ 502 Bad Gateway ุนูู Railway

## ุงููุดููุฉ
ุงูุชุทุจูู ูุนุทู ุฎุทุฃ `502 Bad Gateway` ุนูุฏ ุงููุตูู ุฅููู ุนูู Railway. ูุฐุง ูุนูู ุฃู ุงูุชุทุจูู ูุง ูุจุฏุฃ ุฃู ูุชููู ููุฑุงู.

## ุงูุฃุณุจุงุจ ุงููุญุชููุฉ

1. **ุงูุชุทุจูู ูุง ูุจุฏุฃ**: ูุฏ ูููู ููุงู ุฎุทุฃ ูู ุจุฏุก ุงูุชุทุจูู ูููุนู ูู ุงูุจุฏุก
2. **ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุฏ ูููู ุงูุชุทุจูู ููุชุธุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง ูุจุฏุฃ
3. **ูุดุงูู ูู PORT**: ูุฏ ูููู ุงูุชุทุจูู ูุง ูุณุชูุน ุนูู ุงููููุฐ ุงูุตุญูุญ
4. **ูุดุงูู ูู ุงูููุงู ุงูุฎูููุฉ**: ุงูููุงู ุงูุฎูููุฉ ูู lifespan ูุฏ ุชุณุจุจ ูุดุงูู

## ุงูุญููู ุงููุทุจูุฉ

### 1. Startup Script (`backend/start.sh`)

ุชู ุฅูุดุงุก startup script ููุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก:
- โ ุงูุชุธุงุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงุฎุชูุงุฑู)
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนู ุญุงูุฉ ุงูุจุฏุก
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

### 2. ุชุญุณูู Lifespan (`backend/main.py`)

- โ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูู lifespan (ุจุฏูู ุฅููุงู ุงูุชุทุจูู)
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนู ุญุงูุฉ ุงูุจุฏุก
- โ ุงูุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุจุฏุฃ ุญุชู ูู ูุดูุช ุงูููุงู ุงูุฎูููุฉ

### 3. ุชุญุณูู ูุนุงูุฌุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (`backend/database.py`)

- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ุนูุฏ ุฅูุดุงุก engine
- โ ูุง ูุฑูุน RuntimeError ูููุน ุจุฏุก ุงูุชุทุจูู
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนู ุญุงูุฉ ุงูุงุชุตุงู

### 4. ุชุญุณูู Dockerfile (`backend/Dockerfile`)

- โ ุงุณุชุฎุฏุงู startup script ุจุฏูุงู ูู CMD ูุจุงุดุฑุฉ
- โ ุฅุถุงูุฉ `--timeout-keep-alive` ูู uvicorn
- โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

## ููููุฉ ุงูุชุญูู ูู ุงูุฅุตูุงุญ

### 1. ูุญุต Logs ุนูู Railway

ุนูู Railway Dashboard:
1. ุงุฐูุจ ุฅูู Service โ Deployments โ Latest
2. ุงูุชุญ Logs
3. ุงุจุญุซ ุนู:
   - โ "๐ Starting Khawam Application..."
   - โ "โ Starting uvicorn server..."
   - โ "โ Application ready to serve requests"
   - โ ุฃู ุฃุฎุทุงุก ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. ูุญุต Health Check

```bash
curl https://khawam-pro-production.up.railway.app/api/health
```

ูุฌุจ ุฃู ูุนูุฏ:
```json
{
  "status": "ok",
  "message": "API is running",
  "database": "connected",
  "port": "8000"
}
```

### 3. ูุญุต ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ

ุนูู Railway Dashboard:
1. ุงุฐูุจ ุฅูู Service โ Variables
2. ุชุฃูุฏ ูู ูุฌูุฏ:
   - `DATABASE_URL` (ูุชู ุชุนูููู ุชููุงุฆูุงู ุนูุฏ ุฑุจุท PostgreSQL)
   - `PORT` (ูุชู ุชุนูููู ุชููุงุฆูุงู ูู ูุจู Railway)

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุชุทุจูู ูุง ูุจุฏุฃ

**ุงูุชุญูู:**
- ุงูุญุต Logs ุนูู Railway
- ุงุจุญุซ ุนู ุฃุฎุทุงุก ูู ุจุฏุก ุงูุชุทุจูู

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู `DATABASE_URL` ููุฌูุฏ
- ุชุฃูุฏ ูู ุฃู PostgreSQL service ูุฑุจูุท ุจุดูู ุตุญูุญ
- ุชุญูู ูู ุฃู ุฌููุน ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุงููุทููุจุฉ ููุฌูุฏุฉ

### ุงููุดููุฉ: ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุญูู:**
```bash
# ูู Logsุ ุงุจุญุซ ุนู:
# "โ Database connection verified"
# ุฃู
# "โ๏ธ Database connection check failed"
```

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู PostgreSQL service ูุนูู
- ุชุฃูุฏ ูู ุฃู `DATABASE_URL` ุตุญูุญ
- ุชุญูู ูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุงุญุฉ ูู Railway

### ุงููุดููุฉ: 502 Bad Gateway ูุณุชูุฑ

**ุงูุชุญูู:**
1. ุงูุญุต Logs ููุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุจุฏุฃ
2. ุชุญูู ูู health check endpoint
3. ุชุญูู ูู ุฃู PORT ุตุญูุญ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุณุชูุน ุนูู `0.0.0.0` ูููุณ `localhost`
- ุชุฃูุฏ ูู ุฃู PORT ูุชู ูุฑุงุกุชู ุจุดูู ุตุญูุญ
- ุชุญูู ูู ุฃู uvicorn ูุจุฏุฃ ุจุฏูู ุฃุฎุทุงุก

## ุงููููุงุช ุงููุนุฏูุฉ

1. โ `backend/start.sh` - Startup script ุฌุฏูุฏ
2. โ `backend/Dockerfile` - ุงุณุชุฎุฏุงู startup script
3. โ `backend/main.py` - ุชุญุณูู lifespan
4. โ `backend/database.py` - ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

## ุฎุทูุงุช ุงููุดุฑ

1. **ุงุฏูุน ุงูุชุบููุฑุงุช ุฅูู GitHub**
   ```bash
   git add .
   git commit -m "Fix Railway 502 error - improve startup and error handling"
   git push
   ```

2. **ุนูู Railway:**
   - ุงูุชุธุฑ ุญุชู ููุชูู ุงูุจูุงุก
   - ุฑุงูุจ Logs ููุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุจุฏุฃ ุจุดูู ุตุญูุญ
   - ุชุญูู ูู health check endpoint

3. **ุงูุชุญูู:**
   ```bash
   curl https://khawam-pro-production.up.railway.app/api/health
   ```

## ููุงุญุธุงุช ูููุฉ

1. **Startup Script**: ุงูุขู ูุณุชุฎุฏู `/app/start.sh` ุจุฏูุงู ูู CMD ูุจุงุดุฑุฉ
2. **Database Connection**: ุงูุชุทุจูู ูุจุฏุฃ ุญุชู ูู ูุงูุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ ูุคูุชุงู
3. **Error Handling**: ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ุชููุน ุฅููุงู ุงูุชุทุจูู
4. **Logging**: ุฑุณุงุฆู ูุงุถุญุฉ ูู Logs ุชุณุงุนุฏ ูู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

